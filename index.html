<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Gesti√≥n PY</title>
    <script src="https://cdn.jsdelivr.net/npm/tesseract.js@5/dist/tesseract.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.1/firebase-firestore-compat.js"></script>
    <style>
        :root { --primary: #27ae60; --blue: #3498db; }
        body { font-family: 'Segoe UI', sans-serif; background: #f4f7f6; margin: 0; display: flex; justify-content: center; }
        .card { background: white; width: 100%; max-width: 480px; min-height: 100vh; padding: 20px; box-sizing: border-box; text-align: center; }
        
        h2 { font-weight: bold; margin-bottom: 30px; font-size: 28px; }
        .auth-form { display: flex; flex-direction: column; gap: 15px; }
        .row { display: flex; gap: 10px; }
        .input-group { position: relative; width: 100%; }
        input { padding: 15px; border-radius: 10px; border: 1px solid #ddd; font-size: 16px; width: 100%; box-sizing: border-box; background: #fff; }
        
        .eye-icon { position: absolute; right: 15px; top: 50%; transform: translateY(-50%); cursor: pointer; font-size: 20px; }
        
        .btn { background: var(--primary); color: white; border: none; padding: 18px; border-radius: 12px; font-weight: bold; cursor: pointer; width: 100%; font-size: 18px; text-transform: uppercase; margin-top: 10px; }
        .btn-reg { background: var(--blue); }
        .link-auth { color: var(--blue); text-decoration: underline; cursor: pointer; display: inline-block; margin-top: 20px; font-size: 15px; }

        /* Estilos del esc√°ner y resultados */
        #scannerSection { display: none; }
        #resultados { text-align: left; background: #fff; padding: 15px; border-radius: 10px; border: 2px solid var(--blue); margin-top: 20px; }
    </style>
</head>
<body>

    <div class="card">
        <div id="loginBox">
            <h2 style="margin-top: 60px;">Ingreso al Sistema</h2>
            <form class="auth-form" id="loginForm">
                <input type="email" id="email" placeholder="Correo electr√≥nico" required>
                <div class="input-group">
                    <input type="password" id="password" placeholder="Contrase√±a" required>
                    <span class="eye-icon" onclick="toggleView('password')">üëÅÔ∏è</span>
                </div>
                <button type="submit" class="btn">INGRESAR</button>
            </form>
            <a class="link-auth" onclick="showRegister(true)">¬øNo tienes cuenta? Reg√≠strate aqu√≠</a>
        </div>

        <div id="registerBox" style="display: none;">
            <h2 style="margin-top: 60px;">Crear Cuenta</h2>
            <form class="auth-form" id="registerForm">
                <div class="row">
                    <input type="text" id="regNombre" placeholder="Nombre" required>
                    <input type="text" id="regApellido" placeholder="Apellido" required>
                </div>
                <input type="email" id="regEmail" placeholder="Correo electr√≥nico" required>
                <div class="input-group">
                    <input type="password" id="regPass" placeholder="Contrase√±a (m√≠n. 6 letras)" required>
                    <span class="eye-icon" onclick="toggleView('regPass')">üëÅÔ∏è</span>
                </div>
                <div class="input-group">
                    <input type="password" id="regPassConf" placeholder="Confirme su contrase√±a" required>
                    <span class="eye-icon" onclick="toggleView('regPassConf')">üëÅÔ∏è</span>
                </div>
                <button type="submit" class="btn btn-reg">REGISTRARME</button>
            </form>
            <a class="link-auth" style="color: #27ae60;" onclick="showRegister(false)">¬øYa tienes cuenta? Inicia sesi√≥n</a>
        </div>

        <div id="scannerSection">
            <h3 id="welcomeMsg"></h3>
            <div style="background:#000; height:260px; border-radius:15px; overflow:hidden;">
                <video id="video" autoplay playsinline style="width:100%; height:100%; object-fit:cover;"></video>
            </div>
            <button class="btn" onclick="capturarCedula()">üì∑ CAPTURAR DATOS</button>
            </div>
    </div>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyAE1KBu1CufjKO65OpVHOPcmhyliQYsoDU",
            authDomain: "miescanerweb.firebaseapp.com",
            projectId: "miescanerweb",
            storageBucket: "miescanerweb.firebasestorage.app",
            messagingSenderId: "403272649163",
            appId: "1:403272649163:web:53f29dd4e676c31d268e4e"
        };
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        // TU LINK DE GOOGLE SHEETS
        const URL_EXCEL = 'https://script.google.com/a/macros/ueno.com.py/s/AKfycbyp50uQF0KAQPWCBh_lwxDwlBEVPd9DXZLkQu5_2NrY15yfQc7Hjg4JljQTNoEkKzSBsA/exec';

        function showRegister(val) {
            document.getElementById('loginBox').style.display = val ? 'none' : 'block';
            document.getElementById('registerBox').style.display = val ? 'block' : 'none';
        }

        function toggleView(id) {
            const input = document.getElementById(id);
            input.type = input.type === 'password' ? 'text' : 'password';
        }

        auth.onAuthStateChanged(user => {
            if (user) {
                document.getElementById('loginBox').style.display = 'none';
                document.getElementById('registerBox').style.display = 'none';
                document.getElementById('scannerSection').style.display = 'block';
                document.getElementById('welcomeMsg').innerText = "Bienvenido: " + (user.displayName || user.email);
            }
        });

        document.getElementById('registerForm').onsubmit = e => {
            e.preventDefault();
            const p1 = document.getElementById('regPass').value;
            const p2 = document.getElementById('regPassConf').value;
            if(p1 !== p2) return alert("Las contrase√±as no coinciden");

            auth.createUserWithEmailAndPassword(document.getElementById('regEmail').value, p1)
                .then(res => {
                    res.user.updateProfile({ displayName: document.getElementById('regNombre').value });
                    alert("Cuenta creada con √©xito");
                })
                .catch(err => alert("Error: " + err.message));
        };

        document.getElementById('loginForm').onsubmit = e => {
            e.preventDefault();
            auth.signInWithEmailAndPassword(document.getElementById('email').value, document.getElementById('password').value)
                .catch(err => alert("Datos incorrectos"));
        };
    </script>
</body>
</html>
